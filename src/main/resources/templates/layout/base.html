<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title layout:title-pattern="$CONTENT_TITLE - $LAYOUT_TITLE">MedCal - Sistema de Gestión Médica</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Alpine.js para interactividad adicional -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- FullCalendar CSS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.css' rel='stylesheet' />
    
    <style>
        /* Configuración personalizada de Tailwind */
        .sidebar-active {
            @apply bg-blue-700 text-white;
        }
        
        .htmx-indicator {
            opacity: 0;
            transition: opacity 500ms ease-in;
        }
        
        .htmx-request .htmx-indicator {
            opacity: 1;
        }
        
        .htmx-request.htmx-indicator {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation Bar -->
    <nav class="bg-blue-600 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-stethoscope text-2xl"></i>
                        <span class="ml-2 text-xl font-bold">MedCal</span>
                    </div>
                    <div class="hidden md:block ml-10">
                        <div class="flex items-baseline space-x-4">
                            <a href="/dashboard" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                                <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                            </a>
                            <a href="/doctors" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                                <i class="fas fa-user-md mr-2"></i>Doctores
                            </a>
                            <a href="/patients" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                                <i class="fas fa-users mr-2"></i>Pacientes
                            </a>
                            <a href="/appointments" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                                <i class="fas fa-calendar-alt mr-2"></i>Citas
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Indicador de carga HTMX -->
                    <div class="htmx-indicator">
                        <i class="fas fa-spinner fa-spin text-white"></i>
                    </div>
                    
                    <!-- Usuario dropdown -->
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-white">
                            <i class="fas fa-user-circle text-2xl"></i>
                            <span class="ml-2 hidden md:block">Dr. Usuario</span>
                            <i class="fas fa-chevron-down ml-1"></i>
                        </button>
                        
                        <div x-show="open" @click.away="open = false" 
                             class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                            <a href="/profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-user mr-2"></i>Perfil
                            </a>
                            <a href="/settings" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-cog mr-2"></i>Configuración
                            </a>
                            <div class="border-t border-gray-100"></div>
                            <a href="/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesión
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile menu -->
        <div class="md:hidden" x-data="{ mobileOpen: false }">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3" x-show="mobileOpen">
                <a href="/dashboard" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Dashboard</a>
                <a href="/doctors" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Doctores</a>
                <a href="/patients" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Pacientes</a>
                <a href="/appointments" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">Citas</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="flex mb-6" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="/dashboard" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
                        <i class="fas fa-home mr-2"></i>Inicio
                    </a>
                </li>
                <li layout:fragment="breadcrumb">
                    <!-- Breadcrumb específico de cada página -->
                </li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="mb-6" layout:fragment="page-header">
            <h1 class="text-3xl font-bold text-gray-900">Página</h1>
        </div>

        <!-- Alerts/Messages -->
        <div id="alerts-container" class="mb-6">
            <!-- Mensajes dinámicos se insertarán aquí -->
        </div>

        <!-- Page Content -->
        <div layout:fragment="content">
            <!-- El contenido específico de cada página se insertará aquí -->
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-500">
                    © 2024 MedCal - Sistema de Gestión Médica
                </div>
                <div class="text-sm text-gray-500">
                    Desarrollado con Spring Boot + Thymeleaf + HTMX
                </div>
            </div>
        </div>
    </footer>

    <!-- FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales/es.js'></script>
    
    <!-- Scripts personalizados -->
    <script layout:fragment="scripts">
        <!-- Scripts específicos de cada página -->
    </script>
    
    <script>
        // Configuración global de HTMX
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar HTMX para mostrar mensajes de error
            document.body.addEventListener('htmx:responseError', function(evt) {
                showAlert('Error al procesar la solicitud', 'error');
            });
            
            // Configurar HTMX para mostrar mensajes de éxito
            document.body.addEventListener('htmx:afterRequest', function(evt) {
                if (evt.detail.xhr.status === 200 && evt.detail.xhr.getResponseHeader('HX-Trigger')) {
                    const trigger = evt.detail.xhr.getResponseHeader('HX-Trigger');
                    if (trigger.includes('success')) {
                        showAlert('Operación completada exitosamente', 'success');
                    }
                }
            });
        });
        
        // Función para mostrar alertas
        function showAlert(message, type = 'info') {
            const alertsContainer = document.getElementById('alerts-container');
            const alertId = 'alert-' + Date.now();
            
            const alertColors = {
                success: 'bg-green-100 border-green-500 text-green-700',
                error: 'bg-red-100 border-red-500 text-red-700',
                warning: 'bg-yellow-100 border-yellow-500 text-yellow-700',
                info: 'bg-blue-100 border-blue-500 text-blue-700'
            };
            
            const alertIcons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            const alertHtml = `
                <div id="${alertId}" class="border-l-4 p-4 mb-4 ${alertColors[type]} rounded-r-lg">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="${alertIcons[type]}"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium">${message}</p>
                        </div>
                        <div class="ml-auto pl-3">
                            <button onclick="document.getElementById('${alertId}').remove()" 
                                    class="text-lg font-semibold leading-none hover:opacity-75">
                                &times;
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            alertsContainer.insertAdjacentHTML('beforeend', alertHtml);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                const alert = document.getElementById(alertId);
                if (alert) alert.remove();
            }, 5000);
        }
    </script>
</body>
</html>
